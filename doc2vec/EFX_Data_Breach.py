import utils_v2
import os
# db_path = os.path.join('data', 'database', 'stocks.db')
# conn = sqlite3.connect(db_path)
# rets = utils_v2.get_returns(conn, 'EFX', '2017-09-07', horizon=20)
beta_efx = 1.03
# Sep 06, 07 (release date), 08
label_efx_closes = [141.39, 142.72, 123.23]
label_spy_closes = [246.90, 246.87, 246.58]
ret_efx = (label_efx_closes[2]-label_efx_closes[0])/label_efx_closes[0]
ret_spy = (label_spy_closes[2]-label_spy_closes[0])/label_spy_closes[0]
alpha_efx = ret_efx - beta_efx * ret_spy
print(alpha_efx)

# Aug 29 30 31 Sep 01, 05, 06
ph_efx_closes = [140.80, 141.42, 142.47, 141.59, 141.10, 141.39]
ph_spy_closes = [244.85, 246.01, 247.49, 247.84, 246.06, 246.90]
alpha_efx = []
for i in range(0,len(ph_efx_closes)-1):
    alpha_efx.append((ph_efx_closes[i+1]-
                      ph_efx_closes[i])/ph_efx_closes[i]-
                     beta_efx*(ph_spy_closes[i+1]-ph_spy_closes[i])/
                     ph_spy_closes[i])
print(alpha_efx)

corpus = 'EX-99.1 2 exhibit99120170907.htm EXHIBIT 99.1 Exhibit 99.1 equifaxlogoa04a01a04.jpg For Immediate Release September 7, 2017 Equifax Announces Cybersecurity Incident Involving Consumer Information No Evidence of Unauthorized Access to Core Consumer or Commercial Credit Reporting Databases Company to Offer Free Identity Theft Protection and Credit File Monitoring to All U.S. Consumers Equifax Inc. (NYSE: EFX) today announced a cybersecurity incident potentially impacting approximately 143 million U.S. consumers. Criminals exploited a U.S. website application vulnerability to gain access to certain files. Based on the company’s investigation, the unauthorized access occurred from mid-May through July 2017. The company has found no evidence of unauthorized activity on Equifax’s core consumer or commercial credit reporting databases. The information accessed primarily includes names, Social Security numbers, birth dates, addresses and, in some instances, driver’s license numbers.  In addition, credit card numbers for approximately 209,000 U.S. consumers, and certain dispute documents with personal identifying information for approximately 182,000 U.S. consumers, were accessed. As part of its investigation of this application vulnerability, Equifax also identified unauthorized access to limited personal information for certain UK and Canadian residents. Equifax will work with UK and Canadian regulators to determine appropriate next steps. The company has found no evidence that personal information of consumers in any other country has been impacted. Equifax discovered the unauthorized access on July 29 of this year and acted immediately to stop the intrusion. The company promptly engaged a leading, independent cybersecurity firm that has been conducting a comprehensive forensic review to determine the scope of the intrusion, including the specific data impacted. Equifax also reported the criminal access to law enforcement and continues to work with authorities. While the company’s investigation is substantially complete, it remains ongoing and is expected to be completed in the coming weeks. This is clearly a disappointing event for our company, and one that strikes at the heart of who we are and what we do. I apologize to consumers and our business customers for the concern and frustration this causes, said Chairman and Chief Executive Officer, Richard F. Smith. We pride ourselves on being a leader in managing and protecting data, and we are conducting a thorough review of our overall security operations. We also are focused on consumer protection and have developed a comprehensive portfolio of services to support all U.S. consumers, regardless of whether they were impacted by this incident. Equifax has established a dedicated website, www.equifaxsecurity2017.com, to help consumers determine if their information has been potentially impacted and to sign up for credit file monitoring and identity theft protection. The offering, called TrustedID Premier, includes 3-Bureau credit monitoring of Equifax, Experian and TransUnion credit reports; copies of Equifax credit reports; the ability to lock and unlock Equifax credit reports; identity theft insurance; and Internet scanning for Social Security numbers - all complimentary to U.S. consumers for one year. The website also provides additional information on steps consumers can take to protect their personal information. Equifax recommends that consumers with additional questions visit www.equifaxsecurity2017.com or contact a dedicated call center at 866-447-7559, which the company set up to assist consumers. The call center is open every day (including weekends) from 7:00 a.m. - 1:00 a.m. Eastern time. In addition to the website, Equifax will send direct mail notices to consumers whose credit card numbers or dispute documents with personal identifying information were impacted. Equifax also is in the process of contacting U.S. state and federal regulators and has sent written notifications to all U.S. state attorneys general, which includes Equifax contact information for regulator inquiries. Equifax has engaged a leading, independent cybersecurity firm to conduct an assessment and provide recommendations on steps that can be taken to help prevent this type of incident from happening again. CEO Smith said, I’ve told our entire team that our goal can’t be simply to fix the problem and move on. Confronting cybersecurity risks is a daily fight. While we’ve made significant investments in data security, we recognize we must do more. And we will. About Equifax Equifax is a global information solutions company that uses trusted unique data, innovative analytics, technology and industry expertise to power organizations and individuals around the world by transforming knowledge into insights that help make more informed business and personal decisions. Headquartered in Atlanta, Ga., Equifax operates or has investments in 24 countries in North America, Central and South America, Europe and the Asia Pacific region. It is a member of Standard & Poors (S&P) 500® Index, and its common stock is traded on the New York Stock Exchange (NYSE) under the symbol EFX. Equifax employs approximately 9,900 employees worldwide. Forward-Looking Statements This release contains forward-looking statements and forward-looking information. These statements can be identified by expressions of belief, expectation or intention, as well as estimates and statements that are not historical fact. These statements are based on certain factors and assumptions with respect to the investigation of the cybersecurity incident to date. While the company believes these factors and assumptions to be reasonable based on information currently available, they may prove to be incorrect. Several factors could cause actual results to differ materially from those expressed or implied in the forward-looking statements, including, but not limited to, the final results of the investigation, including the final scope of the intrusion, the type of information accessed and the number of consumers impacted. A summary of additional risks and uncertainties can be found in our Annual Report on Form 10-K for the year ended December 31, 2016, including without limitation under the captions Item 1. Business -- Governmental Regulation and -- Forward-Looking Statements and Item 1A. Risk Factors, and in our other filings with the U.S. Securities and Exchange Commission. Forward-looking statements are given only as at the date of this release and the company disclaims any obligation to update or revise the forward-looking statements, whether as a result of new information, future events or otherwise, except as required by law. Contacts: Ines Gutzmer Corporate Communications mediainquiries@equifax.com 404-885-8555'

import spacy
from spacy.lang.en.lemmatizer import LOOKUP
from spacy.lang.en.stop_words import STOP_WORDS
nlp = spacy.blank('en')

def en_lemmatizer(doc):
    for token in doc:
        token.lemma_ = LOOKUP.get(token.lower_, u'oov')
        if token in STOP_WORDS:
            token.is_stop = True
    return doc

nlp.add_pipe(en_lemmatizer, name='en_lemmatizer', last=True)

pickle_path = 'dm_dbow_tfidf_full_1_best_estimator.pkl'                                                                   
corpus = nlp(corpus)
corpus = " ".join(list(map(lambda x: x.lemma_, filter(lambda token: token.is_alpha and not token.is_stop and not token.lemma_ == u'oov', corpus))))
import pickle
with open(pickle_path, 'rb') as p:
    best_estimator = pickle.load(p)
result = best_estimator.predict([{'price_history': alpha_efx, 'corpus': corpus}])
print(result)

EFX_link = 'https://www.alpa.org/~/media/UAL/Files/eLibraries/Communications/press-release/ualmec-statement-2017-04-13.pdf'
corpus = 'UAL MEC Statement Regarding United Express Flight 3411 As the story of United Express Flight 3411, operated by Republic Airline, continues to virally circulate in the news and on social media, your United Master Executive Council (MEC) has intentionally withheld judgment because of the rapid pace at which information, both accurate and inaccurate, has been released and manipulated. The safety and well-being of our passengers is the highest priority for United pilots, and this should not have escalated into a violent encounter. United pilots are infuriated by this event. This occurred on one of our contracted Express carriers, separately owned and operated by Republic Airline, and was ultimately caused by the grossly inappropriate response by the Chicago Department of Aviation. It is important to review these baseline facts: 1. This violent incident should never have happened and was a result of gross excessive force by Chicago Department of Aviation personnel. 2. No United employees were involved in the physical altercation. 3. Social media ire should properly be directed at the Chicago Aviation Department. 4. This occurred on an Express flight operated by Republic Airline, as such, the flight crew and cabin crew of Flight 3411 are employees of Republic Airline, not United Airlines. 5. United Airlines CEO Oscar Munoz has apologized for United Airlines, the actions of the Chicago Department of Aviation, and the actions of our Express partner, Republic Airline. On April 9, 2017, United Express Flight 3411, operated by Republic, was preparing to depart Chicago O’Hare (ORD) to Louisville (SDF). Republic Airline made the decision to assign four of their crewmembers to deadhead on Flight 3411 within minutes of the scheduled departure. Although four passengers would have to be removed from this flight to accommodate the Republic crew, the goal was to get the other 70 passengers on their way to SDF and ensure a flight crew needed the next day would also be in place. By all reports, the Republic flight crew was courteous and calm throughout the event, and three passengers left the flight voluntarily for compensation. After repeatedly asking the fourth passenger to give up his seat to no avail, the gate agent requested the assistance of law enforcement. For reasons unknown to us, instead of trained Chicago Police Department officers being dispatched to the scene, Chicago Department of Aviation personnel responded. At this point, without direction and outside the control of United Airlines or the Republic crew, the Chicago Department of Aviation forcibly removed the passenger. Members of local airport law enforcement are normally important security partners who assist aircrews in ensuring the safety of everyone on the airplane. This event was an anomaly and is not how United or the police are expected to treat passengers when there is no security threat. United pilots have always been the true leaders of this company, and our fellow employees count on us to continue to do what we do best—deliver a world class product and safely transport our passengers around the world. We cannot let this huge distraction affect our ability to do our jobs. We have successfully flown through more turbulent times, and we will weather this storm as well. Ultimately, United must be measured by more than this one incident on a single United Express flight; this airline is comprised of more than 82,000 employees, including over 12,500 pilots, working every day to safely fly around the globe. For 91 years, United has earned the trust of millions of passengers, and we will continue earning their trust, despite the incident on this United Express flight. The United Airlines MEC is confident that the steps we are taking as a company will ensure this type of inexcusable event never happens again.'

corpus = nlp(corpus)
corpus = " ".join(list(map(lambda x: x.lemma_, filter(lambda token: token.is_alpha and not token.is_stop and not token.lemma_ == u'oov', corpus))))

result = best_estimator.predict([{'price_history': alpha_efx, 'corpus': corpus}])